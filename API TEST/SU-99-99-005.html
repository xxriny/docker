<div class="row wrapper border-bottom white-bg page-heading menu dhkim">
	<div id="oldPath" class="col-lg-5">
		<h2>
			<lb class="">API TEST</lb>
		</h2>
		<ol class="breadcrumb">
			<li>
				<lb class=""></lb>
			</li>
			<li>
				<lb class="lb-25"></lb>
			</li>
			<li class="active"><strong>
					<lb class=""></lb>
					</lb>
				</strong></li>
		</ol>
	</div>
	<div id="menuPath" class="col-lg-5">
	</div>
	<div class="col-lg-7">
		<div class="title-action"></div>
	</div>
</div>

<div class="wrapper wrapper-content" style="height:calc(100% - 92px);">
	<div id="splitter" class="row" style="height:100%;">
		<div>
			<div class="ibox float-e-margins">
				<div class="ibox-title">
					<h5>
						<span>
							<lb class="lb-108"></lb>
						</span>
					</h5>
					<div class="ibox-tools">
						<span style="padding: 0px 20px 0px 0px;">
						</span>
					</div>
				</div>
				<div class="ibox-content">
					<div>
						<ul id="addHttp" style="list-style:none; margin:0px; padding:0px; min-width: 0;">
							<li style="line-height: 20px; font-size:15px; display:block;"><a href="#">
									<div class="result" style="display:flex; flex-direction:column;"></div>
								</a>
								<button id="btnDelete" style="display:none; margin-left:15px; float: right;">삭제</button>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>

		<div>
			<div class="ibox float-e-margins">
				<div class="ibox-title">
					<h5>
						<span>
							<lb>API TEST</lb>
						</span>
					</h5>
					<div class="ibox-tools">

					</div>
					<div class="ibox-content" style="padding : 0;">
						<hr class="hr-space">
						<div style="align-items: center; display: flex; flex : 1 1 auto ">
							<span class="request-post">POST</span>
							<div style="display: flex; flex : 1">
								<input id="addValue" class="input-tag-4 k-textbox" type="text"
									style="width : 100%; padding: 5px 0 5px 10px;">
							</div>
							<button id="btnSend" href="#" class="btn btn-w-m btn-primary"
								style="padding : 6px; margin-left: 10px; width : 15px;"><i
									class="fa fa-check"></i>보내기</a>
						</div>
						<div>
							<div class="row">
								<ul class="body-list">
									<li>
										<h5 style="float : none; font-size : 15px ; display: inline-block;">Body</h5>
									</li>
									<li class="body-row"><a href="#body">Raw</a></li>
									<li class="body-headers" style="margin-bottom : 10px;"><a href="#headrs">Headers</a>
									</li>
									<li class="request-type" style="float:right">
										<div id="error">JSON</div>
									</li>
								</ul>
								<div class="col-sm-12">
									<div class="line-numbers">
										<span></span>
									</div>
									<textarea id="request-body" class="text-box" rows="5" cols="30"
										onkeyup="$.main.fn_valCheck()"></textarea>

								</div>
							</div>

							<div class="row">
								<ul class="body-list">
									<li>
										<h5 style="margin-right: 15px;"><a href="#body">Body</a></h5>
									</li>
									<li>
										<h5 style="float : left; font-size : 15px "><a href="#cookies">Cookies</a></h5>
									</li>
									<li>
										<h5 style="float : left; font-size : 15px "><a href="#headers">Headers</a></h5>
									</li>
								</ul>
								<div class="col-sm-12">
									<div class="line-numbers">
										<span></span>
									</div>
									<textarea id="response-body" readonly="readonly" class="text-box" rows="5"
										cols="30"></textarea>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

<script>
$(document).ready(function () {
	//=======================================================================
	//(1) function 및 variable scope 설정 :: (메인은 main/main_detail, 팝업 및 서브는 sub)
	//=======================================================================
	screenName = "API-Test";

	$.extend({
		main: {
			btn: document.getElementById('btnSend'),
			addValue: document.getElementById('addValue'),
			result: document.getElementById('result'),

			//-----------------------------------------------------------------------
			// Description :: 화면 초기화 콜백
			//-----------------------------------------------------------------------
			fn_init: function () {
				try {
					mint.init('$.main.fn_initCallback');

				} catch (e) {
					mint.common.errorLog(e, {"screenName": screenName, "fnName": "$.main.fn_init"});
				}
			},//end fn_init()

			//-----------------------------------------------------------------------
			// Description :: JSON 체크
			//-----------------------------------------------------------------------
			fn_validateJSON: function () {
				try {
					var requestData = $('#request-body').val();
					$('#request-body').on('propertychange change keyup paste input', function () {
						try {
							jsonObject = JSON.parse(requestData);
							$('#error').text('JSON');
						} catch (e) {
							$('#error').text('NOT JSON')
						}
					})
				} catch (e) {

				}
			},

			//-----------------------------------------------------------------------
			// Description :: JSON 형식 정렬
			//-----------------------------------------------------------------------
			fn_valCheck: function () {
				try {
					$.main.fn_validateJSON();
					var requestBody = $('#request-body').val();
					var jsonData = JSON.parse(requestBody);
					$('#request-body').val(JSON.stringify(jsonData, null, 4));
				} catch (error) {

				}
			},

			//-----------------------------------------------------------------------
			// Description :: 파라미터로 값 받기
			//-----------------------------------------------------------------------
			fn_getUrl: function (test) {
				try {
					let url = addValue.value;
					console.log(test);
					var requestBody = $('#request-body').val();
					requestBody = JSON.parse(requestBody);
					var requestObject = new Object();
					requestObject.url = test;
					requestObject.requestData = requestBody;
					console.log(JSON.stringify(requestObject));
					mint.callService(requestObject, screenName, 'API-TEST', function (responseData) {
						responseData = JSON.stringify(responseData, null, 4);
						$('#response-body').val(responseData);
					});
					//fn_setCookie(url, responseData, 30);
				} catch (e) {
					alert(e);
				}

			},


			//-----------------------------------------------------------------------
			// Description :: 화면 초기화 콜백
			//-----------------------------------------------------------------------
			fn_initCallback: function () {
				try {

					$("#splitter").kendoSplitter({
						panes: [
							{size: "25%"}
						]
					});

					$.main.fn_initTree();
					mint.common.siteMenuPath(screenName);
				} catch (e) {
					mint.common.errorLog(e, {"screenName": screenName, "fnName": "$.main.fn_initCallback"});
				}
			},//end fn_initCallback()

			//-----------------------------------------------------------------------
			// Description :: fn_initTree
			//-----------------------------------------------------------------------
			fn_initTree: function () {
				try {
				} catch (e) {
					mint.common.errorLog(e, {"screenName": screenName, "fnName": "$.main.fn_initTree"});
				}
			},//end fn_initTree
		}
	});

			//=======================================================================
			// (4) 이벤트 핸들러 정의
			//=======================================================================
		 //-----------------------------------------------------------------------
		 // Description :: 초기화.
		 //-----------------------------------------------------------------------
		 $("#btnClear").click(function () {
				$.main.fn_editorClear();
			 });

		 //-----------------------------------------------------------------------
		 // Description :: 저장된 쿠키 목록에 보여지도록
		 //-----------------------------------------------------------------------
		 function fn_displayStoredCookies() {
			    const cookies = document.cookie.split(';');
			    const result = document.querySelector('.result');

			    for (const cookie of cookies) {
			        const [cookieName, cookieValue] = cookie.trim().split('=');
			        const list = document.createElement('div');
			        const del = document.querySelector('#btnDelete').cloneNode(true);

			        if(!cookieName.startsWith('h')){
			        	//console.log(cookieName.startsWith('h'));
			        	document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT;' ;
			        }
			        else{
			        	//console.log(cookieName.startsWith('h'));
			        	list.innerHTML = cookie;
				        result.appendChild(list);
				        list.prepend(del);
				        list.style.cssText = 'text-overflow: ellipsis; overflow: hidden; white-space: nowrap;';
						del.innerText = '삭제';
						del.style.display='inline-block';
						del.style.fontSize = '10px';
						del.style.border='none';
						del.style.marginRight = '10px';
						del.style.right ='17px';
						del.style.marginBottom = '10px';
						del.addEventListener('click', fn_deleteList);
			        }
			    }
			};
			
		 //-----------------------------------------------------------------------
		 // Description :: API 테스트 보내기
		 //-----------------------------------------------------------------------
		 $('#btnSend').click(function addHttp() {
				if (addValue.value == false) {
					alert('내용을 입력하세요!');
				} else {
					let url = addValue.value;
					console.log('넣어주는 값' + url)
					$.main.fn_getUrl(url);
					list = document.createElement('div');
					result = document.querySelector('.result')
					del = document.querySelector('#btnDelete').cloneNode(true);
					list.innerHTML = addValue.value;
					result.appendChild(list);
					list.prepend(del);
					list.style.cssText = 'text-overflow: ellipsis; overflow: hidden; white-space: nowrap;'
					del.innerText = '삭제';
					del.style.display = 'inline-block';
					del.style.fontSize = '10px';
					del.style.border = 'none';
					del.style.marginRight = '10px';
					del.style.right = '17px';
					del.style.marginBottom = '10px';
					del.addEventListener('click', fn_deleteList);
				}
			});
		 
		 //-----------------------------------------------------------------------
		 // Description :: 목록 리스트 지우기
		 //-----------------------------------------------------------------------
		 function fn_deleteList(e) {
				const removeOne = e.target.parentElement;
				const cookieName = removeOne.innerText;
				
				fn_deleteCookie(cookieName);
				
				removeOne.remove();
		 };
		 
		//-----------------------------------------------------------------------
		 // Description :: 삭제 버튼 누른 리스트의 쿠키 지우기
		 //-----------------------------------------------------------------------
		 function fn_deleteCookie(name) {
			 const cookie = name.split("\n");
			 console.log(cookie[1]);
			 const cookies = document.cookie.split('; ');

			 for(var i = 0; i < cookies.length; i++){
				 if(cookies[i] == cookie[1]){
					 document.cookie = cookies[i] + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT;domain=localhost;path=/;';
					 console.log('쿠키 삭제를 완료 했습니다.');
				 }
			 }
		 };
		 
		//-----------------------------------------------------------------------
		 // Description :: 쿠키 생성 함수
		 //-----------------------------------------------------------------------
		 function fn_setCookie(url, value, days){
				if(days){
					 var date = new Date();
					 date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
					 var expires = "; expires=" + date.toGMTString();
				} else {
					 var expires = "";
				}
				
				document.cookie = url + expires + "; path=/";
				console.log(document.cookie);
				console.log('만료기간 설정 완료 되었습니다.');
		 };
		 
		 //-----------------------------------------------------------------------
		 // Description :: 시스템 조회
		 //-----------------------------------------------------------------------
		 $('#btnSend').click(function () {
				try {
				} catch (e) {
					mint.common.errorLog(e, {"screenName": screenName, "fnName": "btn-search"});
				}
			});
		
		 //=======================================================================
		 // (5) 기타 Function 정의
		 //=======================================================================
		 	const requestTextArea = $('.request-textarea');
			const responseTextArea = $('.response-textarea');
			const lineNumbers = $('.line-numbers');

			// Description :: 동시 스크롤
			requestTextArea.on('scroll', e => {
				lineNumbers.scrollTop(requestTextArea.scrollTop())
			});
			
			responseTextArea.on('scroll', e => {
				lineNumbers.scrollTop(responseTextArea.scrollTop())
			});

			lineNumbers.on('scroll', e => {
				textArea.scrollTop(lineNumbers.scrollTop())
			});
			
			// Description :: line numbers
			requestTextArea.on('keyup', e => {
				const numberOfLines = e.target.value.split('\n').length;
				lineNumbers.html(Array(numberOfLines).fill('<span></span>').join(''))
			});
			
			responseTextArea.on('keyup', e => {
				const numberOfLines = e.target.value.split('\n').length;
				lineNumbers.html(Array(numberOfLines).fill('<span></span>').join(''))
			});
			
			requestTextArea.on('keydown', e => {
				
				if (e.keyCode === 9) {
					var start = this.selectionStart
					var end = this.selectionEnd;

					this.value = requestTextArea.value.subString(0, start) + '\t' + requestTextArea.value.subString(end);
					this.selectionStart = this.selectionEnd = start+1;
				}
			});
			
			responseTextArea.on('keydown', e => {
				
				if (e.keyCode === 9) {
					var start = this.selectionStart
					var end = this.selectionEnd;

					this.value = responseTextArea.value.subString(0, start) + '\t' + responseTextArea.value.subString(end);
					this.selectionStart = this.selectionEnd = start+1;
				}
			});
		 //=======================================================================
		 // (6) 화면 로딩시 실행할 항목 기술
		 //=======================================================================
		 $.main.fn_init();
		 mint.label.attachLabel(null);
		 fn_displayStoredCookies();
		 
		 //-----------------------------------------------------------------------
		 // Description :: 서버 Search Click 이벤트 (팝업)
		 //-----------------------------------------------------------------------
		 

		 //-----------------------------------------------------------------------
		 // Description :: 담당자 Search Click 이벤트 (팝업)
		 //-----------------------------------------------------------------------

	});

</script>

<style>
		.body-list {
			list-style: none;
			padding: 0 15px 0 15px;
		}

		.body-list>li:first-child {
			float: none;
		}

		.body-list>li {
			float: left;
			padding-right: 15px;
		}

		.request-post {
			margin-right: 10px;
			border: 1px solid #dcdcdc;
			padding: 10px 50px 10px 50px;
			border-radius: 10px;
		}

		a {
			color: black;
		}

		.col-sm-12 {
			display: inline-flex;
			line-height: 21px;

		}

		textarea {
			height: 200px;
			width: 100%;
			border: 1px solid #dcdcdc;
			resize: none;
			line-height: 21px;
			padding: 0px;
			outline: none;
		}
 
		.line-numbers {
			width: 40px;
			text-align: center;
			border: 1px solid #dcdcdc;
			border-right: 0px;
			height: 200px;
			overflow: hidden;
		}

		.line-numbers span {
			counter-increment: linenumber;
		}

		.line-numbers span::before {
			content: counter(linenumber);
			display: block;
			color: #18a689;
		}
</style>